load spatial;

create or replace temp table blocks as from st_read('SRCS_Census_Blocks.geojson');

create or replace temp table fixed as
from blocks where GEOID20 not in ('060971521002009', '060971521002016', '060971530011000', '060971523002002', '060971520001010', '060971527021000', '060971527011010')
union
-- PTES/HVES
from blocks 
select 
    * exclude (geom),
    st_intersection(geom, ST_GeomFromText('POLYGON ((-122.70196553719893 38.45725354365072, -122.69914147335442 38.455685350058076, -122.69744940509784 38.457168927396225, -122.69947892286415 38.457557747963335, -122.70115214022731 38.457481036083266, -122.70157214310592 38.457673996977576, -122.70196553719893 38.45725354365072))')) as geom
where GEOID20 in ('060971523002002')
union
from blocks 
select 
    * exclude (geom),
    st_difference(geom, ST_GeomFromText('POLYGON ((-122.70196553719893 38.45725354365072, -122.69914147335442 38.455685350058076, -122.69744940509784 38.457168927396225, -122.69947892286415 38.457557747963335, -122.70115214022731 38.457481036083266, -122.70157214310592 38.457673996977576, -122.70196553719893 38.45725354365072))')) as geom
where GEOID20 in ('060971523002002')
union
-- 101 at SRHS
from blocks 
select 
    * exclude (geom),
    st_intersection(geom, ST_GeomFromText('POLYGON ((-122.72566493709935 38.456117091410505, -122.72670944753489 38.45594806308205, -122.72682872961127 38.44468576521979, -122.7217053801265 38.445162792236545, -122.72438557213364 38.45580792488721, -122.72566493709935 38.456117091410505))')) as geom
where GEOID20 in ('060971521002009', '060971521002016', '060971530011000')
union
from blocks 
select 
    * exclude (geom),
    st_difference(geom, ST_GeomFromText('POLYGON ((-122.72566493709935 38.456117091410505, -122.72670944753489 38.45594806308205, -122.72682872961127 38.44468576521979, -122.7217053801265 38.445162792236545, -122.72438557213364 38.45580792488721, -122.72566493709935 38.456117091410505))')) as geom
where GEOID20 in ('060971521002009', '060971521002016', '060971530011000')
union
-- 101 at Morgan St
from blocks 
select 
    * exclude (geom),
    st_intersection(geom, ST_GeomFromText('POLYGON ((-122.72005540857002 38.44106968343874 , -122.72064185226256 38.44081921585044 , -122.71877380254207 38.43821137524529 , -122.71779530030776 38.44057038016527 , -122.72005540857002 38.44106968343874))')) as geom
where GEOID20 in ('060971520001010')
union
from blocks 
select 
    * exclude (geom),
    st_difference(geom, ST_GeomFromText('POLYGON ((-122.72005540857002 38.44106968343874 , -122.72064185226256 38.44081921585044 , -122.71877380254207 38.43821137524529 , -122.71779530030776 38.44057038016527 , -122.72005540857002 38.44106968343874))')) as geom
where GEOID20 in ('060971520001010')
union
-- Riebli boundary
from blocks 
select 
    * exclude (geom),
    st_intersection(geom, ST_GeomFromText('POLYGON ((-122.74097286750984 38.49970214096089, -122.73441863176515 38.49155286925759, -122.71897013178331 38.49129560199469, -122.71252777859935 38.53254952668732, -122.7380342381438 38.53702328180779, -122.74459945307906 38.5338259335104, -122.74461870879988 38.53151347398125, -122.74422573613046 38.528654231912896, -122.73990447033809 38.52114330172367, -122.74052252283482 38.50418843338795, -122.7409172528192 38.50002842691396, -122.74097286750984 38.49970214096089))')) as geom
where GEOID20 in ('060971527021000', '060971527011010')
union
from blocks 
select 
    * exclude (geom),
    st_difference(geom, ST_GeomFromText('POLYGON ((-122.74097286750984 38.49970214096089, -122.73441863176515 38.49155286925759, -122.71897013178331 38.49129560199469, -122.71252777859935 38.53254952668732, -122.7380342381438 38.53702328180779, -122.74459945307906 38.5338259335104, -122.74461870879988 38.53151347398125, -122.74422573613046 38.528654231912896, -122.73990447033809 38.52114330172367, -122.74052252283482 38.50418843338795, -122.7409172528192 38.50002842691396, -122.74097286750984 38.49970214096089))')) as geom
where GEOID20 in ('060971527021000', '060971527011010')
;

copy fixed to 'SRCS_Census_Blocks_Fixed.geojson' (format GDAL, driver 'GeoJSON');